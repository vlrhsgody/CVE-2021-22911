# CVE-2021-22911

### 요약

- Rocker.chat은 오픈소스 팀 채팅 플랫폼이다.
- Rocket Chat 3.12.1~3.13.2에서는 해당 getPasswordPolicy 방식이 NoSQL Injection 공격에 취약하며 인증/권한 부여가 필요하지 않음
- 비밀번호 재설정 토큰을 유출하여 일반 사용자 계정을 탈취하는 데 사용될 수 있음

### 환경 구성 및 실행

- wget https://github.com/vulhub/vulhub/tree/master/rocketchat/CVE-2021-22911
- `docker compose up -d`

### 취약점 재현 단계

1. 로그인 페이지에서 비밀번호를 재설정하면 서버가 데이터 베이스에 비밀번호 재설정 토큰을 생성함
2. NoSQL Injection을 사용하여 이 비밀번호 재설정 토큰을 노출시킬 수 있음
3. 비밀번호 재설정 토큰을 사용하여 사용자 비밀번호를 변경할 수 있음

### 익스플로잇 진행

- 비밀번호 재설정시 서버가 데이터 베이스에 비밀번호 재설정 토큰을 생성
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/145347f3-805c-47f2-aaad-75ad9869d70f/73d102f7-26e5-45e0-8ed9-0daf1aa710b5/Untitled.png)
    
- [CVE-2021-22911.py](http://CVE-2021-22911.py)를 통해 비밀번호 재설정 토큰을 추출함
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/145347f3-805c-47f2-aaad-75ad9869d70f/962b1d6a-3482-49fd-b011-a0b3fd5eca72/Untitled.png)
    
- 비밀번호 재설정 토큰을 이용해 비밀번호 재설정 토큰을 추출할 수 있고 이를 통해 NoSQL Injection 가능함
